Implementation based on https://github.com/ethereum/go-ethereum/tree/v1.10.23